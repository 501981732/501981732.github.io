<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LS CACHE | gblw</title>
    <meta name="description" content="一个前端小学生">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.ac99ad03.css" as="style"><link rel="preload" href="/assets/js/app.2e26f941.js" as="script"><link rel="preload" href="/assets/js/38.f7b94dc4.js" as="script"><link rel="prefetch" href="/assets/js/1.9abbfca6.js"><link rel="prefetch" href="/assets/js/10.f5aa46b0.js"><link rel="prefetch" href="/assets/js/11.8d9fc089.js"><link rel="prefetch" href="/assets/js/12.da5d20a5.js"><link rel="prefetch" href="/assets/js/13.7ccc43bd.js"><link rel="prefetch" href="/assets/js/14.936637cc.js"><link rel="prefetch" href="/assets/js/15.35e22122.js"><link rel="prefetch" href="/assets/js/16.287d904c.js"><link rel="prefetch" href="/assets/js/17.7040011b.js"><link rel="prefetch" href="/assets/js/18.7659f702.js"><link rel="prefetch" href="/assets/js/19.9e094f67.js"><link rel="prefetch" href="/assets/js/20.1a01400b.js"><link rel="prefetch" href="/assets/js/21.a8d12454.js"><link rel="prefetch" href="/assets/js/22.9ebe5653.js"><link rel="prefetch" href="/assets/js/23.f1967079.js"><link rel="prefetch" href="/assets/js/24.174f624d.js"><link rel="prefetch" href="/assets/js/25.c79ed86e.js"><link rel="prefetch" href="/assets/js/26.404bf4b8.js"><link rel="prefetch" href="/assets/js/27.2f1aff94.js"><link rel="prefetch" href="/assets/js/28.062e58ea.js"><link rel="prefetch" href="/assets/js/29.20a59d1a.js"><link rel="prefetch" href="/assets/js/3.c5473e86.js"><link rel="prefetch" href="/assets/js/30.930bca93.js"><link rel="prefetch" href="/assets/js/31.bd2ca60e.js"><link rel="prefetch" href="/assets/js/32.0a5874ee.js"><link rel="prefetch" href="/assets/js/33.feeb8947.js"><link rel="prefetch" href="/assets/js/34.030535d4.js"><link rel="prefetch" href="/assets/js/35.01224053.js"><link rel="prefetch" href="/assets/js/36.9bc679ea.js"><link rel="prefetch" href="/assets/js/37.e5d7c81b.js"><link rel="prefetch" href="/assets/js/39.2e4c3e17.js"><link rel="prefetch" href="/assets/js/4.0acad576.js"><link rel="prefetch" href="/assets/js/40.e6cc435a.js"><link rel="prefetch" href="/assets/js/41.f50d104c.js"><link rel="prefetch" href="/assets/js/42.ee95280a.js"><link rel="prefetch" href="/assets/js/43.e003dc81.js"><link rel="prefetch" href="/assets/js/44.56217885.js"><link rel="prefetch" href="/assets/js/45.22c09290.js"><link rel="prefetch" href="/assets/js/46.c698132a.js"><link rel="prefetch" href="/assets/js/47.7e5929fe.js"><link rel="prefetch" href="/assets/js/48.0dc5263c.js"><link rel="prefetch" href="/assets/js/49.3c6d7ea6.js"><link rel="prefetch" href="/assets/js/5.759e7092.js"><link rel="prefetch" href="/assets/js/50.7d658f31.js"><link rel="prefetch" href="/assets/js/51.fbd8c3c3.js"><link rel="prefetch" href="/assets/js/52.e3eb2ede.js"><link rel="prefetch" href="/assets/js/53.10c05965.js"><link rel="prefetch" href="/assets/js/54.0ecccd4c.js"><link rel="prefetch" href="/assets/js/55.a85740c6.js"><link rel="prefetch" href="/assets/js/56.77e3a891.js"><link rel="prefetch" href="/assets/js/57.67babd87.js"><link rel="prefetch" href="/assets/js/58.856f7672.js"><link rel="prefetch" href="/assets/js/59.d03ef1b7.js"><link rel="prefetch" href="/assets/js/6.8621d802.js"><link rel="prefetch" href="/assets/js/60.b1170398.js"><link rel="prefetch" href="/assets/js/61.97dd3d3c.js"><link rel="prefetch" href="/assets/js/62.b2eedb7b.js"><link rel="prefetch" href="/assets/js/63.fb58a706.js"><link rel="prefetch" href="/assets/js/64.9aa1b041.js"><link rel="prefetch" href="/assets/js/65.faaf9d55.js"><link rel="prefetch" href="/assets/js/66.fbba48ae.js"><link rel="prefetch" href="/assets/js/67.c8593857.js"><link rel="prefetch" href="/assets/js/68.52c632f2.js"><link rel="prefetch" href="/assets/js/69.7a87fda1.js"><link rel="prefetch" href="/assets/js/7.594670aa.js"><link rel="prefetch" href="/assets/js/70.0f9d8114.js"><link rel="prefetch" href="/assets/js/71.d7a82f0c.js"><link rel="prefetch" href="/assets/js/72.fb115c3b.js"><link rel="prefetch" href="/assets/js/73.e56484a9.js"><link rel="prefetch" href="/assets/js/74.ea8bc62e.js"><link rel="prefetch" href="/assets/js/75.5c7a35ab.js"><link rel="prefetch" href="/assets/js/76.3617452b.js"><link rel="prefetch" href="/assets/js/77.8ab6c71a.js"><link rel="prefetch" href="/assets/js/78.b1fe5865.js"><link rel="prefetch" href="/assets/js/79.ea4ba328.js"><link rel="prefetch" href="/assets/js/8.178a8915.js"><link rel="prefetch" href="/assets/js/80.42c16667.js"><link rel="prefetch" href="/assets/js/81.b5141187.js"><link rel="prefetch" href="/assets/js/82.17c01558.js"><link rel="prefetch" href="/assets/js/83.b735e3e5.js"><link rel="prefetch" href="/assets/js/84.15e7b175.js"><link rel="prefetch" href="/assets/js/9.e55349fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ac99ad03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gblw</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link router-link-active">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link router-link-active">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/FE/代码规范.html" class="sidebar-link">代码规范</a></li><li><a href="/FE/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/FE/缓存.html" class="sidebar-link">前端缓存</a></li><li><a href="/FE/从0写个SDK包ls-cache-files.html" class="active sidebar-link">从0写个SDK:性能优化之ls-cache-files</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/FE/从0用ts重构axios.html" class="sidebar-link">从0用ts重构axios</a></li><li><a href="/FE/优雅的使用icon.html" class="sidebar-link">优雅的使用icon</a></li><li><a href="/FE/css workflow.html" class="sidebar-link">css workflow</a></li><li><a href="/FE/csshoudini.html" class="sidebar-link">csshoudini</a></li><li><a href="/FE/postcss了解下~.html" class="sidebar-link">postcss了解下~</a></li><li><a href="/FE/babel polyfill runtime了解一下.html" class="sidebar-link">babel polyfill runtime了解一下</a></li><li><a href="/FE/FLIP动画.html" class="sidebar-link">FLIP动画</a></li><li><a href="/FE/GPU加速原理.html" class="sidebar-link">GPU加速原理</a></li><li><a href="/FE/Promise原理.html" class="sidebar-link">Promise原理</a></li><li><a href="/FE/前端路由原理.html" class="sidebar-link">前端路由原理</a></li><li><a href="/FE/webpack原理.html" class="sidebar-link">webpack原理</a></li><li><a href="/FE/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/FE/数据结构与算法.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/FE/image转base64插件.html" class="sidebar-link">image转base64插件</a></li><li><a href="/FE/canvas.html" class="sidebar-link">canvas(小册子)</a></li><li><a href="/FE/如何写好动效.html" class="sidebar-link">大厂H5开发实战手册:如何写好动效.md(小册子)</a></li><li><a href="/FE/秒做动画.html" class="sidebar-link">秒做动画:AE稿直接生成动画</a></li><li><a href="/FE/前端安全.html" class="sidebar-link">前端安全</a></li><li><a href="/FE/img-2源码看动态创建webworker.html" class="sidebar-link">img-2源码看动态创建webworker</a></li><li><a href="/FE/eventloop.html" class="sidebar-link">eventloop</a></li><li><a href="/FE/typescript.html" class="sidebar-link">typescript</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vue相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>日记杂七乱八</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h3 id="ls-cache"><a href="#ls-cache" aria-hidden="true" class="header-anchor">#</a> LS CACHE</h3> <pre><code>利用浏览器缓存localStorage，缓存静态资源（目前支持css,js类型），第二次请求时，直接从本地文件中中读取资源，节约网络请求，优化性能。
</code></pre> <ol><li>首次加载的情况下 会动态加载js 并将内容存到localStorage。</li> <li>非首次加载 会从localStorage中取出来插入到模板中。</li> <li>有完整的缓存更新机制，可局部更新，或全量更新已存储的文件。</li> <li>有良好的容错机制。</li> <li>每次RD同步传一份资源的配置文件(或者FE自己维护)，FE根据配置文件和缓存中的文件进行版本标识。从而决定是利用缓存还是重新请求。</li></ol> <h3 id="流程"><a href="#流程" aria-hidden="true" class="header-anchor">#</a> 流程</h3> <ol><li>根据配置文件进行初始化</li> <li>判断localstorage是否可用</li> <li>判断本地是否有存储目标文件</li> <li>根据版本判断是否需要全量更新，若不需要更新，则遍历读取本地文件，若某一文件为空，则重新请求在存储</li> <li>判断遍历的目标文件版本是否相同 若不相同，则重新请求存储，否则使用缓存</li></ol> <p><img src="https://pic1.58cdn.com.cn/nowater/cxnomark/n_v2cd68acbc04474e2ca23309e69c019c12.png" alt="image"></p> <h3 id="useage"><a href="#useage" aria-hidden="true" class="header-anchor">#</a> useage</h3> <ol><li><strong>模板中同步一份配置文件</strong></li></ol> <h4 id="v0-1-1配置文件"><a href="#v0-1-1配置文件" aria-hidden="true" class="header-anchor">#</a> v0.1.1配置文件</h4> <div class="language- extra-class"><pre class="language-text"><code>window.__LS__MAP = {
    'js/vue.js': 'https://j1.58cdn.com.cn/git/hrg-innovate/pc-super-employer-home/static/js/vue.chunk_v20190808162950.js'//资源地址
}
</code></pre></div><h4 id="v0-2-2配置文件"><a href="#v0-2-2配置文件" aria-hidden="true" class="header-anchor">#</a> v0.2.2配置文件</h4> <div class="language- extra-class"><pre class="language-text"><code>window.__LS__MAP = {
    version: 1,
    list: [{
        version: 1,
        url: 'http://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css',//资源地址
        //type?: 'css'
    },{
        version: 1,
        url: 'http://j1.58cdn.com.cn/global_app/js/lib/zepto.min.js',//资源地址
        //type?: 'js'
    }]
}
</code></pre></div><ol start="2"><li><p><strong>初始化</strong></p></li> <li><p>支持所有方式的加载</p></li> <li><p>提供压缩版和未压缩版 默认未压缩版本: <em>/node_module/ls-cache-files/lib/index.js</em> 压缩版本 <em>/node_module/ls-cache-files/lib/index.min.js</em></p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm install ls-cache-files
import LSCacheFiles from 'ls-cache-files'
LSCacheFiles.init()
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;script src='https://raw.githubusercontent.com/501981732/ls-cache-files/master/lib/index.min.js'&gt;引入
文件: https://github.com/501981732/ls-cache-files/blob/master/lib/index.min.js放入自己公司cdn或者嵌入模板html中
LSCacheFiles.init()
</code></pre></div><ol start="3"><li><strong>运行成功的存储结果</strong></li></ol> <p>localSotrage中</p> <table><thead><tr><th>key</th> <th>value</th></tr></thead> <tbody><tr><td>__LS__version</td> <td>1</td></tr> <tr><td>__LS__https://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css</td> <td>对应css</td></tr> <tr><td>__LS__https://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css_version</td> <td>1</td></tr> <tr><td>__LS__http://j1.58cdn.com.cn/global_app/js/lib/zepto.min.js</td> <td>对应js</td></tr> <tr><td>__LS__http://j1.58cdn.com.cn/global_app/js/lib/zepto.min.js_version</td> <td>1</td></tr></tbody></table> <p>html中</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;style type=&quot;text/css&quot; id=&quot;__LS__main.chunk_v20190830183911.css&quot;&gt;...&lt;/style&gt;
&lt;script type=&quot;text/css&quot; id=&quot;__LS__zepto.min.js&quot;&gt;...&lt;/style&gt;
</code></pre></div><h3 id="lscachefiles-api"><a href="#lscachefiles-api" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles API</h3> <pre><code>需要先配置window.__LS__MAP文件，或者将__LS__MAP挂载到LSCacheFiles上面
</code></pre> <h3 id="lscachefiles-ls-map"><a href="#lscachefiles-ls-map" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.__LS__MAP</h3> <p>可挂载配置文件,默认会读取全局配置文件 <em>window.__LS__MAP</em></p> <h4 id="lscachefiles-init"><a href="#lscachefiles-init" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.init()</h4> <p>根据__LS__MAP配置初始化缓存操作</p> <h4 id="lscachefiles-checkandcachefile-url-version"><a href="#lscachefiles-checkandcachefile-url-version" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.checkAndCacheFile(url,version)</h4> <p>请求url并缓存到本地，并且缓存当前版本
单独调用也会判断</p> <ol><li>本地是否有存该文件</li> <li>版本与version是否相同
当本地没有存该文件，或者有存该文件但是version不同时会请求数据并缓存版本</li></ol> <div class="language- extra-class"><pre class="language-text"><code>LSCacheFiles.checkAndCacheFile('https://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css',1)

</code></pre></div><p>存储表现为</p> <table><thead><tr><th>key</th> <th>value</th></tr></thead> <tbody><tr><td>__LS__https://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css</td> <td>对应css</td></tr> <tr><td>__LS__https://c.58cdn.com.cn/git/hrg-innovate/m-super-employer/static/css/main.chunk_v20190830183911.css_version</td> <td>1</td></tr></tbody></table> <h4 id="lscachefiles-loadandcachefile-url-version"><a href="#lscachefiles-loadandcachefile-url-version" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.loadAndCacheFile(url,version)</h4> <p>类似checkFileAndCache功能，但是检查本地是否有改文件和版本。每次都会重新请求并缓存文件。so...没啥用</p> <h4 id="lscachefiles-needupdate-flag"><a href="#lscachefiles-needupdate-flag" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.needUpdate(flag)</h4> <p>LSCacheFiles.needUpdate() 自动根据配置文件__LS__MAP的version字段和localstorage字段判断是否需要全部更新缓存文件,
也可传入flag手动配置是否需要手动触发全量更新</p> <h4 id="lscachefiles-checkcanlocalstorage"><a href="#lscachefiles-checkcanlocalstorage" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.checkCanLocalStorage</h4> <p>判断本地存储是否可用，可以根据此字段判断是否手动开启缓存</p> <h4 id="lscachefiles-checkusedspace"><a href="#lscachefiles-checkusedspace" aria-hidden="true" class="header-anchor">#</a> LSCacheFiles.checkUsedSpace()</h4> <p>本地localstorage剩余存储空间，可根据此字段决定是否开启缓存</p> <h3 id="注意"><a href="#注意" aria-hidden="true" class="header-anchor">#</a> 注意</h3> <ol><li>不适合太大文件的存储，低版本浏览器单个localStoragekey存储能力有限</li> <li>支持typescript声明文件</li></ol> <h4 id="过程中的问题"><a href="#过程中的问题" aria-hidden="true" class="header-anchor">#</a> 过程中的问题</h4> <h3 id="简单webpack配置"><a href="#简单webpack配置" aria-hidden="true" class="header-anchor">#</a> 简单webpack配置</h3> <div class="language- extra-class"><pre class="language-text"><code>const webpack = require('webpack');
const path = require('path');

const config = {
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'lib'),
    filename: 'index.min.js',
    library: 'LSCacheFiles',
    sourceMapFilename: 'index.min.map',
    libraryTarget: 'umd'
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: 'babel-loader',
        exclude: /node_modules/
      }
    ]
  },
  devtool: 'source-map'
}

module.exports = config;
</code></pre></div><h3 id="babel源文件"><a href="#babel源文件" aria-hidden="true" class="header-anchor">#</a> babel源文件</h3> <p>https://blog.meathill.com/js/some-tips-of-babel-preset-env-config.html</p> <ol><li>package.json</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  &quot;scripts&quot;: {
    &quot;prod&quot;: &quot;webpack --mode=production&quot;,
    &quot;dev&quot;: &quot;webpack --mode=development&quot;,
    &quot;babel&quot;: &quot;babel src -d lib --copy-files&quot;,
    &quot;prepublish&quot;: &quot;babel src -d lib --copy-files &amp; webpack --mode=production&quot;
  },
</code></pre></div><ol start="2"><li>.babelrc</li></ol> <p>npm install --save @babel/polyfill
npm install --save @babel/preset-env
npm install --save-dev @babel/plugin-transform-runtime
npm install --save @babel/runtime</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
    ]
  ],
    &quot;plugins&quot;: [&quot;@babel/plugin-transform-runtime&quot;]
}
</code></pre></div><p><strong>polyfill</strong> 由于用到了promise Object.keys 等 需要垫片,写SDK最好用es3等，尽量减少垫片的使用，使包越小越好</p> <ol start="3"><li><strong>polyfill</strong>引入方式</li></ol> <h4 id="方式1"><a href="#方式1" aria-hidden="true" class="header-anchor">#</a> 方式1</h4> <pre><code>- &quot;useBuiltIns&quot;: &quot;usage&quot; 不需要再入口文件再单独引入polyfill
</code></pre> <blockquote><p>When setting <code>useBuiltIns: 'usage'</code>, polyfills are automatically imported when needed  Please remove the direct import of <code>core-js</code> or use <code>useBuiltIns: 'entry'</code> instead.</p></blockquote> <p><strong>也是最佳方案</strong></p> <pre><code>```
{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      {
        &quot;useBuiltIns&quot;: &quot;usage&quot;,
        &quot;corejs&quot;: 3
      }
    ]
  ],
    &quot;plugins&quot;: [&quot;@babel/plugin-transform-runtime&quot;]
}
```
</code></pre> <h3 id="方式2"><a href="#方式2" aria-hidden="true" class="header-anchor">#</a> 方式2</h3> <div class="language- extra-class"><pre class="language-text"><code>    - &quot;useBuiltIns&quot;: &quot;entry&quot;
    - 然后在入口手动引入 import &quot;@babel/polyfill&quot;;
</code></pre></div><h3 id="方式3"><a href="#方式3" aria-hidden="true" class="header-anchor">#</a> 方式3</h3> <blockquote><p>@babel/polyfill 是对 core-js的封装，引用了core-js的内容和生成器（regenerator-runtime)。 v7.4之后，这个仓库就被废弃了，希望用户自己选择使用哪个兼容库。</p></blockquote> <p>之前</p> <div class="language- extra-class"><pre class="language-text"><code>import &quot;@babel/polyfill&quot;;
</code></pre></div><p>之后改为</p> <div class="language- extra-class"><pre class="language-text"><code>import &quot;core-js/stable&quot;;
import &quot;regenerator-runtime/runtime&quot;;
</code></pre></div><p>但是并未发现是按需加载，打包之后仍然很大，so<strong>目前@babel/preset-env + useBuiltIns: 'usage' 仍然是最好的选择</strong></p> <h5 id="core-js2-core-js3-区别"><a href="#core-js2-core-js3-区别" aria-hidden="true" class="header-anchor">#</a> core-js2 core-js3 区别</h5> <blockquote><p>core-js 2 封版于 1.5 年之前，所以里面只有对 1.5 年之前 feature 的 polyfill，最近 1.5 年新增的 feature 都不支持，也就存在因为新功能没有 polyfill 于是在旧浏览器里失败的风险。</p></blockquote> <h3 id="报错问题"><a href="#报错问题" aria-hidden="true" class="header-anchor">#</a> 报错问题</h3> <div class="language- extra-class"><pre class="language-text"><code> Cannot assign to read only property 'exports' of object '#&lt;Object&gt;'
</code></pre></div><p>webpack打包后总是出现这种问题,google的答案大都是 (You can't mix import and module.exports)[https://github.com/webpack/webpack/issues/4039],
但是本身并未发现这种问题，之后全部改为es6语法模块后ok，但是通过script导出的全局变量会是 LSCacheFiles.default，多一层.
改为commonjs语法后排查问题，发现不babel的话没问题，so问题出在babel配置项。之前babelrc</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      {
        &quot;useBuiltIns&quot;: &quot;usage&quot;,
        &quot;corejs&quot;: 3,
      }
    ]
  ],
    &quot;plugins&quot;: [&quot;@babel/plugin-transform-runtime&quot;]
}
</code></pre></div><p><a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="noopener noreferrer">babel-preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>配置项目中发现modules字段有umd的配置,改为umd，配合webpack中的 libraryTarget: 'umd'搞定。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/501981732/my-vuepress/edit/master/FE/从0写个SDK包ls-cache-files.md" target="_blank" rel="noopener noreferrer">改善此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/11/2019, 5:12:15 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/38.f7b94dc4.js" defer></script><script src="/assets/js/app.2e26f941.js" defer></script>
  </body>
</html>
