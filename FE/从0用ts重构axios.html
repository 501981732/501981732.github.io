<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>axios 实现 | gblw</title>
    <meta name="description" content="一个前端小学生">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.ac99ad03.css" as="style"><link rel="preload" href="/assets/js/app.2e26f941.js" as="script"><link rel="preload" href="/assets/js/40.e6cc435a.js" as="script"><link rel="prefetch" href="/assets/js/1.9abbfca6.js"><link rel="prefetch" href="/assets/js/10.f5aa46b0.js"><link rel="prefetch" href="/assets/js/11.8d9fc089.js"><link rel="prefetch" href="/assets/js/12.da5d20a5.js"><link rel="prefetch" href="/assets/js/13.7ccc43bd.js"><link rel="prefetch" href="/assets/js/14.936637cc.js"><link rel="prefetch" href="/assets/js/15.35e22122.js"><link rel="prefetch" href="/assets/js/16.287d904c.js"><link rel="prefetch" href="/assets/js/17.7040011b.js"><link rel="prefetch" href="/assets/js/18.7659f702.js"><link rel="prefetch" href="/assets/js/19.9e094f67.js"><link rel="prefetch" href="/assets/js/20.1a01400b.js"><link rel="prefetch" href="/assets/js/21.a8d12454.js"><link rel="prefetch" href="/assets/js/22.9ebe5653.js"><link rel="prefetch" href="/assets/js/23.f1967079.js"><link rel="prefetch" href="/assets/js/24.174f624d.js"><link rel="prefetch" href="/assets/js/25.c79ed86e.js"><link rel="prefetch" href="/assets/js/26.404bf4b8.js"><link rel="prefetch" href="/assets/js/27.2f1aff94.js"><link rel="prefetch" href="/assets/js/28.062e58ea.js"><link rel="prefetch" href="/assets/js/29.20a59d1a.js"><link rel="prefetch" href="/assets/js/3.c5473e86.js"><link rel="prefetch" href="/assets/js/30.930bca93.js"><link rel="prefetch" href="/assets/js/31.bd2ca60e.js"><link rel="prefetch" href="/assets/js/32.0a5874ee.js"><link rel="prefetch" href="/assets/js/33.feeb8947.js"><link rel="prefetch" href="/assets/js/34.030535d4.js"><link rel="prefetch" href="/assets/js/35.01224053.js"><link rel="prefetch" href="/assets/js/36.9bc679ea.js"><link rel="prefetch" href="/assets/js/37.e5d7c81b.js"><link rel="prefetch" href="/assets/js/38.f7b94dc4.js"><link rel="prefetch" href="/assets/js/39.2e4c3e17.js"><link rel="prefetch" href="/assets/js/4.0acad576.js"><link rel="prefetch" href="/assets/js/41.f50d104c.js"><link rel="prefetch" href="/assets/js/42.ee95280a.js"><link rel="prefetch" href="/assets/js/43.e003dc81.js"><link rel="prefetch" href="/assets/js/44.56217885.js"><link rel="prefetch" href="/assets/js/45.22c09290.js"><link rel="prefetch" href="/assets/js/46.c698132a.js"><link rel="prefetch" href="/assets/js/47.7e5929fe.js"><link rel="prefetch" href="/assets/js/48.0dc5263c.js"><link rel="prefetch" href="/assets/js/49.3c6d7ea6.js"><link rel="prefetch" href="/assets/js/5.759e7092.js"><link rel="prefetch" href="/assets/js/50.7d658f31.js"><link rel="prefetch" href="/assets/js/51.fbd8c3c3.js"><link rel="prefetch" href="/assets/js/52.e3eb2ede.js"><link rel="prefetch" href="/assets/js/53.10c05965.js"><link rel="prefetch" href="/assets/js/54.0ecccd4c.js"><link rel="prefetch" href="/assets/js/55.a85740c6.js"><link rel="prefetch" href="/assets/js/56.77e3a891.js"><link rel="prefetch" href="/assets/js/57.67babd87.js"><link rel="prefetch" href="/assets/js/58.856f7672.js"><link rel="prefetch" href="/assets/js/59.d03ef1b7.js"><link rel="prefetch" href="/assets/js/6.8621d802.js"><link rel="prefetch" href="/assets/js/60.b1170398.js"><link rel="prefetch" href="/assets/js/61.97dd3d3c.js"><link rel="prefetch" href="/assets/js/62.b2eedb7b.js"><link rel="prefetch" href="/assets/js/63.fb58a706.js"><link rel="prefetch" href="/assets/js/64.9aa1b041.js"><link rel="prefetch" href="/assets/js/65.faaf9d55.js"><link rel="prefetch" href="/assets/js/66.fbba48ae.js"><link rel="prefetch" href="/assets/js/67.c8593857.js"><link rel="prefetch" href="/assets/js/68.52c632f2.js"><link rel="prefetch" href="/assets/js/69.7a87fda1.js"><link rel="prefetch" href="/assets/js/7.594670aa.js"><link rel="prefetch" href="/assets/js/70.0f9d8114.js"><link rel="prefetch" href="/assets/js/71.d7a82f0c.js"><link rel="prefetch" href="/assets/js/72.fb115c3b.js"><link rel="prefetch" href="/assets/js/73.e56484a9.js"><link rel="prefetch" href="/assets/js/74.ea8bc62e.js"><link rel="prefetch" href="/assets/js/75.5c7a35ab.js"><link rel="prefetch" href="/assets/js/76.3617452b.js"><link rel="prefetch" href="/assets/js/77.8ab6c71a.js"><link rel="prefetch" href="/assets/js/78.b1fe5865.js"><link rel="prefetch" href="/assets/js/79.ea4ba328.js"><link rel="prefetch" href="/assets/js/8.178a8915.js"><link rel="prefetch" href="/assets/js/80.42c16667.js"><link rel="prefetch" href="/assets/js/81.b5141187.js"><link rel="prefetch" href="/assets/js/82.17c01558.js"><link rel="prefetch" href="/assets/js/83.b735e3e5.js"><link rel="prefetch" href="/assets/js/84.15e7b175.js"><link rel="prefetch" href="/assets/js/9.e55349fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ac99ad03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gblw</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link router-link-active">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link router-link-active">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/FE/代码规范.html" class="sidebar-link">代码规范</a></li><li><a href="/FE/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/FE/缓存.html" class="sidebar-link">前端缓存</a></li><li><a href="/FE/从0写个SDK包ls-cache-files.html" class="sidebar-link">从0写个SDK:性能优化之ls-cache-files</a></li><li><a href="/FE/从0用ts重构axios.html" class="active sidebar-link">从0用ts重构axios</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#axios-实现" class="sidebar-link">axios 实现</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#错误信息增强-扩展error类-axioserror-extends-error" class="sidebar-link">错误信息增强 扩展Error类 AxiosError extends Error</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#ts-axios-接口扩展【工厂模式的合理运用，设计思想的转变】" class="sidebar-link">ts-axios 接口扩展【工厂模式的合理运用，设计思想的转变】</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#ts-axios-拦截器实现【巧妙运用-promise-链式调用】" class="sidebar-link">ts-axios 拦截器实现【巧妙运用 Promise 链式调用】</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#ts-axios-配置化实现【巧妙运用策略模式实现配置合并】" class="sidebar-link">ts-axios 配置化实现【巧妙运用策略模式实现配置合并】</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#ts-axios-取消功能实现【巧妙运用-promise-实现异步分离】" class="sidebar-link">ts-axios 取消功能实现【巧妙运用 Promise 实现异步分离】</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#需求分析：" class="sidebar-link">需求分析：</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#异步分离的设计方案" class="sidebar-link">异步分离的设计方案</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#利用primise实现异步分离" class="sidebar-link">利用Primise实现异步分离</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#canceltoken类的实现" class="sidebar-link">CancelToken类的实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#其他功能" class="sidebar-link">其他功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#withcredentials" class="sidebar-link">withCredentials</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#xsrf防御" class="sidebar-link">XSRF防御</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#上传与下载的进度监控" class="sidebar-link">上传与下载的进度监控</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#自定义合法状态码" class="sidebar-link">自定义合法状态码</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#自定义参数序列" class="sidebar-link">自定义参数序列</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#baseurl" class="sidebar-link">baseURL</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#单元测试" class="sidebar-link">单元测试</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#部署-编译与发布" class="sidebar-link">部署 编译与发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#编译打包" class="sidebar-link">编译打包</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#rollup简单讲解：" class="sidebar-link">rollup简单讲解：</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#自动化部署" class="sidebar-link">自动化部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#编写部署脚本" class="sidebar-link">编写部署脚本</a></li><li class="sidebar-sub-header"><a href="/FE/从0用ts重构axios.html#运行部署脚本" class="sidebar-link">运行部署脚本</a></li></ul></li></ul></li><li><a href="/FE/优雅的使用icon.html" class="sidebar-link">优雅的使用icon</a></li><li><a href="/FE/css workflow.html" class="sidebar-link">css workflow</a></li><li><a href="/FE/csshoudini.html" class="sidebar-link">csshoudini</a></li><li><a href="/FE/postcss了解下~.html" class="sidebar-link">postcss了解下~</a></li><li><a href="/FE/babel polyfill runtime了解一下.html" class="sidebar-link">babel polyfill runtime了解一下</a></li><li><a href="/FE/FLIP动画.html" class="sidebar-link">FLIP动画</a></li><li><a href="/FE/GPU加速原理.html" class="sidebar-link">GPU加速原理</a></li><li><a href="/FE/Promise原理.html" class="sidebar-link">Promise原理</a></li><li><a href="/FE/前端路由原理.html" class="sidebar-link">前端路由原理</a></li><li><a href="/FE/webpack原理.html" class="sidebar-link">webpack原理</a></li><li><a href="/FE/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/FE/数据结构与算法.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/FE/image转base64插件.html" class="sidebar-link">image转base64插件</a></li><li><a href="/FE/canvas.html" class="sidebar-link">canvas(小册子)</a></li><li><a href="/FE/如何写好动效.html" class="sidebar-link">大厂H5开发实战手册:如何写好动效.md(小册子)</a></li><li><a href="/FE/秒做动画.html" class="sidebar-link">秒做动画:AE稿直接生成动画</a></li><li><a href="/FE/前端安全.html" class="sidebar-link">前端安全</a></li><li><a href="/FE/img-2源码看动态创建webworker.html" class="sidebar-link">img-2源码看动态创建webworker</a></li><li><a href="/FE/eventloop.html" class="sidebar-link">eventloop</a></li><li><a href="/FE/typescript.html" class="sidebar-link">typescript</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vue相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>日记杂七乱八</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p>todo:</p> <ul><li>性能优化--性能优化易-如何判断性能出现的原因难</li> <li>游戏组件库</li></ul> <blockquote><p>掌握造轮子过程--- 单元测试 ----前端工具的辅助开发----   提成段位</p></blockquote> <ul><li>ts开发项目</li> <li>学会造轮子 单元测试</li> <li>使用先进的开发工具</li> <li>axios实现原理</li></ul> <ol><li>jest</li> <li>tslint</li> <li>commitizen</li> <li>prettier</li> <li>rollupJs</li> <li>semantic release 完全自动化版本管理和软件包发布</li> <li>typescript</li></ol> <h2 id="axios-实现"><a href="#axios-实现" aria-hidden="true" class="header-anchor">#</a> axios 实现</h2> <ul><li><p>在浏览器端使用 XMLHttpRequest 对象通讯</p></li> <li><p>支持 Promise API</p></li> <li><p>支持请求和响应的拦截器</p></li> <li><p>支持请求数据和响应数据的转换</p></li> <li><p>支持请求的取消</p></li> <li><p>JSON 数据的自动转换</p></li> <li><p>客户端防止 XSRF</p> <p>工具：<a href="https://github.com/alexjoverm/typescript-library-starter" target="_blank" rel="noopener noreferrer">typescript-library-starter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <p>集成了许多优秀的开源库：</p> <ul><li>使用 <strong>RollupJS</strong> 帮助我们打包。</li> <li>使用 <strong>Prettier</strong> 和 <strong>TSLint</strong> 帮助我们格式化代码以及保证代码风格一致性。</li> <li>使用 <strong>TypeDoc</strong> 帮助我们自动生成文档并部署到 <strong>GitHub pages</strong>。</li> <li>使用 <strong>Jest</strong>帮助我们做单元测试。</li> <li>使用 <strong>Commitizen</strong>帮助我们生成规范化的提交注释。</li> <li>使用 <strong>Semantic release</strong>帮助我们管理版本和发布。
使用 <strong>husk</strong> 帮助我们更简单地使用 git hooks。</li> <li>使用 <strong>Conventional changelog</strong>帮助我们通过代码提交信息自动生成 change log。</li> <li>Automatic types (*.d.ts) file generation</li> <li>Travis integration and Coveralls report</li></ul> <h2 id="错误信息增强-扩展error类-axioserror-extends-error"><a href="#错误信息增强-扩展error类-axioserror-extends-error" aria-hidden="true" class="header-anchor">#</a> 错误信息增强 扩展Error类 AxiosError extends Error</h2> <h2 id="ts-axios-接口扩展【工厂模式的合理运用，设计思想的转变】"><a href="#ts-axios-接口扩展【工厂模式的合理运用，设计思想的转变】" aria-hidden="true" class="header-anchor">#</a> ts-axios 接口扩展【工厂模式的合理运用，设计思想的转变】</h2> <h2 id="ts-axios-拦截器实现【巧妙运用-promise-链式调用】"><a href="#ts-axios-拦截器实现【巧妙运用-promise-链式调用】" aria-hidden="true" class="header-anchor">#</a> ts-axios 拦截器实现【巧妙运用 Promise 链式调用】</h2> <h2 id="ts-axios-配置化实现【巧妙运用策略模式实现配置合并】"><a href="#ts-axios-配置化实现【巧妙运用策略模式实现配置合并】" aria-hidden="true" class="header-anchor">#</a> ts-axios 配置化实现【巧妙运用策略模式实现配置合并】</h2> <h2 id="ts-axios-取消功能实现【巧妙运用-promise-实现异步分离】"><a href="#ts-axios-取消功能实现【巧妙运用-promise-实现异步分离】" aria-hidden="true" class="header-anchor">#</a> ts-axios 取消功能实现【巧妙运用 Promise 实现异步分离】</h2> <h3 id="需求分析："><a href="#需求分析：" aria-hidden="true" class="header-anchor">#</a> 需求分析：</h3> <p>有时候我们希望取消已经发送的请求：比如输入框搜索，每次输入都要重新请求，通常的解决方案是前端做debounce节流，延时200ms发送请求，当用户连续输入时，当间隔小于200ms不会发送请求。</p> <p>但是当极端情况，后端接口很慢，我超过200ms去输入，在前面的请求还没有响应前，可能已经发出多个请求了，接口的相应时长不定，先发的请求比后发出的请求先相应，就会导致混乱。</p> <p>xhr中adortAPI可以取消请求<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/abort" target="_blank" rel="noopener noreferrer">XMLHttpRequest.abort()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,but 在axios中我们并不能接触到xhr,我们希望在XHR请求中插入一段代码，当我们在外面执行cancel的时候，能驱动这段代码执行，然后执行xhr.abort方法取消请求。</p> <p><strong>调用方式一</strong></p> <p>axios.CancelToken是一个类，
我们直接把它实例化的对象传给请求配置中的 cancelToken 属性，CancelToken 的构造函数参数支持传入一个 executor 方法，该方法的参数是一个取消函数 c，我们可以在 executor 方法执行的内部拿到这个取消函数 c，赋值给我们外部定义的 cancel 变量，之后我们可以通过调用这个 cancel 方法来取消请求。</p> <p>#异步分离的</p> <div class="language- extra-class"><pre class="language-text"><code>const CancelToken = axios.CancelToken;
let cancel;

axios.get('/user/12345', {
  cancelToken: new CancelToken(function executor(c) {
    cancel = c;
  })
});

// 取消请求
cancel();

</code></pre></div><p>我们给 axios 添加一个 CancelToken 的对象，它有一个 source 方法可以返回一个 source 对象，source.token 是在每次请求的时候传给配置对象中的 cancelToken 属性，然后在请求发出去之后，我们可以通过 source.cancel 方法取消请求。</p> <h3 id="异步分离的设计方案"><a href="#异步分离的设计方案" aria-hidden="true" class="header-anchor">#</a> 异步分离的设计方案</h3> <p>我们需要为请求配置一个 cancelToken，然后在外部调用一个 cancel 方法。请求是一个异步过程，最终会执行xhr.send,我们在axios外面是碰不到axios自己封装的xhr的，我们希望在执行cancel的时候去执行 xhr.abort()方法,</p> <p>相当于我们在xhr异步请求的时候插入一段代码，当我们在外部执行cancel的时候驱动这段代码执行从而取消请求。</p> <h3 id="利用primise实现异步分离"><a href="#利用primise实现异步分离" aria-hidden="true" class="header-anchor">#</a> 利用Primise实现异步分离</h3> <p><strong>利用Primise实现异步分离</strong>，在cancelToken中保存一个pending状态的Promise对象，当我们执行cancel的时候能访问到这个Promise，把它从pending状态变成reslove，这样我们就可以在 then 函数中去实现取消请求的逻辑。</p> <div class="language- extra-class"><pre class="language-text"><code>
插入在 xhr.js中

//当 请求传入了 cancelToken 实例，并且该实例内部的promise从pending变成reslove时 会执行
//啥时候回变呢
if (cancelToken) {
  cancelToken.promise
    .then(reason =&gt; {
      request.abort()
      reject(reason)
    })
}
</code></pre></div><h3 id="canceltoken类的实现"><a href="#canceltoken类的实现" aria-hidden="true" class="header-anchor">#</a> CancelToken类的实现</h3> <p>在 CancelToken构造函数内部，实例化一个pending状态的Promise,然后用resolvePromise指向resolve函数,接着执行executor, 在cancel内部会调用resolvePromise，利用闭包，外面可以拿到executor的函数参数，调用该函数，使promise从pending变成resolved。</p> <div class="language- extra-class"><pre class="language-text"><code>export default class CancelToken {
  promise: Promise&lt;string&gt;
  reason?: string

  constructor(executor: CancelExecutor) {
    let resolvePromise: ResolvePromise
    this.promise = new Promise&lt;string&gt;(resolve =&gt; {
      resolvePromise = resolve
    })
    &lt;!--调用的时候 传入CancelToken类里面的c 就是这 里面的function ,执行会  --&gt;
    executor(message =&gt; {
      if (this.reason) {
        return
      }
      this.reason = message
      resolvePromise(this.reason)
    })
  }
}

</code></pre></div><h2 id="其他功能"><a href="#其他功能" aria-hidden="true" class="header-anchor">#</a> 其他功能</h2> <h3 id="withcredentials"><a href="#withcredentials" aria-hidden="true" class="header-anchor">#</a> withCredentials</h3> <blockquote><p>通过CORS解决的跨域问题，默认不会请求不会懈怠cookie的， 需要设置xhr的 WithCredentials为true</p></blockquote> <h3 id="xsrf防御"><a href="#xsrf防御" aria-hidden="true" class="header-anchor">#</a> XSRF防御</h3> <blockquote><p>又叫  CSRF，跨站请求访问。</p></blockquote> <img src="/img/xsrf.png"> <h4 id="防御手段"><a href="#防御手段" aria-hidden="true" class="header-anchor">#</a> 防御手段</h4> <ol><li>验证请求的referer,但是referer也可以伪造</li> <li>服务器端要求每次请求都包含一个<code>token</code>, <code>token</code>在我们每次访问站点的时候生成，并且<code>set-cookie</code>的方式种到客户端。 每次请求的时候从<code>cookie</code>中读取<code>token</code>，添加到<code>headers</code>中。 这样服务端从header中读取<code>token</code>并验证，这个<code>token</code>很难伪造，就能确保安全。</li></ol> <h4 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h4> <div class="language- extra-class"><pre class="language-text"><code>axios.get('/more/get',{
  xsrfCookieName: 'XSRF-TOKEN', // default
  xsrfHeaderName: 'X-XSRF-TOKEN' // default
}).then(res =&gt; {
  console.log(res)
})

</code></pre></div><ol><li>判断是否配置withCredentials为true或者同域请求，再添加字段</li> <li>判断成功从cookie中读取xsrf的token</li> <li>读到在假如到headers的相关字段</li></ol> <p><strong>判断是否同域小技巧</strong>创建一个 a 标签的 DOM，然后设置 href 属性为我们传入的 url，然后可以获取该 DOM 的 protocol、host。当前页面的 url 和请求的 url 都通过这种方式获取。</p> <div class="language- extra-class"><pre class="language-text"><code>const urlParsingNode = document.createElement('a')
const currentOrigin = resolveURL(window.location.href)

function resolveURL(url: string): URLOrigin {
  urlParsingNode.setAttribute('href', url)
  const { protocol, host } = urlParsingNode

  return {
    protocol,
    host
  }
</code></pre></div><h3 id="上传与下载的进度监控"><a href="#上传与下载的进度监控" aria-hidden="true" class="header-anchor">#</a> 上传与下载的进度监控</h3> <h4 id="需求"><a href="#需求" aria-hidden="true" class="header-anchor">#</a> 需求</h4> <p>我们想上传文件或者请求大体积数据的时候知道实时进度，做进度条。xhr提供了<code>progress</code>事件，监听下载进度， <code>xhr.upload</code>也提供<code>progress</code>对上传进度监控</p> <h4 id="使用方法"><a href="#使用方法" aria-hidden="true" class="header-anchor">#</a> 使用方法</h4> <div class="language- extra-class"><pre class="language-text"><code>axios.get('/more/get',{
  onDownloadProgress(progressEvent) {
    // 监听下载进度
  }
})

axios.post('/more/post',{
  onUploadProgress(progressEvent) {
    // 监听上传进度
  }
})
</code></pre></div><p>如果请求的数据是 FormData 类型，我们应该主动删除请求 headers 中的 Content-Type 字段，让浏览器自动根据请求数据设置 Content-Type。比如当我们通过 FormData 上传文件的时候，浏览器会把请求 headers 中的 Content-Type 设置为 multipart/form-data</p> <div class="language- extra-class"><pre class="language-text"><code>      if (onDownloadProgress) {
        request.onprogress = onDownloadProgress
      }

      if (onUploadProgress) {
        request.upload.onprogress = onUploadProgress
      }
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export function isFormData(val: any): boolean {
  return typeof val !== 'undefined' &amp;&amp; val instanceof FormData
}
</code></pre></div><h4 id="auth授权"><a href="#auth授权" aria-hidden="true" class="header-anchor">#</a> auth授权</h4> <p>HTTP 协议中的 Authorization 请求 header 会包含服务器用于验证用户代理身份的凭证，通常会在服务器返回 401 Unauthorized 状态码以及 WWW-Authenticate 消息头之后在后续请求中发送此消息头。</p> <p>axios 库也允许你在请求配置中配置 auth 属性，auth 是一个对象结构，包含 username 和 password 2 个属性。一旦用户在请求的时候配置这俩属性，我们就会自动往 HTTP 的 请求 header 中添加 Authorization 属性，它的值为 Basic 加密串。 这里的加密串是 username:password base64 加密后的结果。</p> <p>useage</p> <div class="language- extra-class"><pre class="language-text"><code>axios.post('/more/post', {
  a: 1
}, {
  auth: {
    username: 'Yee',
    password: '123456'
  }
}).then(res =&gt; {
  console.log(res)
})
</code></pre></div><p>实现</p> <div class="language- extra-class"><pre class="language-text"><code>if (auth) {
  headers['Authorization'] = 'Basic ' + btoa(auth.username + ':' + auth.password)
}
</code></pre></div><p>server</p> <div class="language- extra-class"><pre class="language-text"><code>router.post('/more/post', function(req, res) {
  const auth = req.headers.authorization
  const [type, credentials] = auth.split(' ')
  console.log(atob(credentials))
  const [username, password] = atob(credentials).split(':')
  if (type === 'Basic' &amp;&amp; username === 'Yee' &amp;&amp; password === '123456') {
    res.json(req.body)
  } else {
    res.end('UnAuthorization')
  }
})
</code></pre></div><h3 id="自定义合法状态码"><a href="#自定义合法状态码" aria-hidden="true" class="header-anchor">#</a> 自定义合法状态码</h3> <p>useage:</p> <div class="language- extra-class"><pre class="language-text"><code>axios.get('/more/304', {
  validateStatus(status) {
    return status &gt;= 200 &amp;&amp; status &lt; 400
  }
}).then(res =&gt; {
  console.log(res)
}).catch((e: AxiosError) =&gt; {
  console.log(e.message)
})
</code></pre></div><p>实现</p> <div class="language- extra-class"><pre class="language-text"><code>function handleResponse(response: AxiosResponse): void {
  if (!validateStatus || validateStatus(response.status)) {
    resolve(response)
  } else {
    reject(
      createError(
        `Request failed with status code ${response.status}`,
        config,
        null,
        request,
        response
      )
    )
  }
}
</code></pre></div><p>如果没有配置 validateStatus 以及 validateStatus 函数返回的值为 true 的时候，都认为是合法的,正常 resolve(response)，否则都创建一个错误。</p> <h3 id="自定义参数序列"><a href="#自定义参数序列" aria-hidden="true" class="header-anchor">#</a> 自定义参数序列</h3> <p>axios默认会对我们传入的params对象解析，根据一定规则把它解析成字符串拼接在url后面。默认对字符串encode，对一些特殊字符<code>@ +</code>不转义,我们也可以自己配置解析规则，接受params返回值作为解析后的结果。</p> <p>useage</p> <div class="language- extra-class"><pre class="language-text"><code>axios.get('/more/get', {
  params: {
    a: 1,
    b: 2,
    c: ['a', 'b', 'c']
  },
  paramsSerializer(params) {
    return qs.stringify(params, { arrayFormat: 'brackets' })
  }
}).then(res =&gt; {
  console.log(res)
})
</code></pre></div><p>实现</p> <div class="language- extra-class"><pre class="language-text"><code>url.ts

  if (paramsSerializer) {
    serializedParams = paramsSerializer(params)
  } else if (isURLSearchParams(params)) {
    serializedParams = params.toString()
  } else {
    ...
</code></pre></div><h3 id="baseurl"><a href="#baseurl" aria-hidden="true" class="header-anchor">#</a> baseURL</h3> <div class="language- extra-class"><pre class="language-text"><code>url.js
export function isAbsoluteURL(url: string): boolean {
  return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)
}

export function combineURL(baseURL: string, relativeURL?: string): string {
  return relativeURL ? baseURL.replace(/\/+$/, '') + '/' + relativeURL.replace(/^\/+/, '') : baseURL
}
dispatchRequest.ts调用
function transformURL(config: AxiosRequestConfig): string {
  let { url, params, paramsSerializer, baseURL } = config
  if (baseURL &amp;&amp; !isAbsoluteURL(url!)) {
    url = combineURL(baseURL, url)
  }
  return buildURL(url!, params, paramsSerializer)
}

</code></pre></div><h2 id="单元测试"><a href="#单元测试" aria-hidden="true" class="header-anchor">#</a> 单元测试</h2> <h2 id="部署-编译与发布"><a href="#部署-编译与发布" aria-hidden="true" class="header-anchor">#</a> 部署 编译与发布</h2> <h3 id="编译打包"><a href="#编译打包" aria-hidden="true" class="header-anchor">#</a> 编译打包</h3> <p>使用rollup打包，相对于webpack,更适合去编译和打包一些js库</p> <p>rollup.config.ts</p> <div class="language- extra-class"><pre class="language-text"><code>
import resolve from 'rollup-plugin-node-resolve'
import commonjs from 'rollup-plugin-commonjs'
import sourceMaps from 'rollup-plugin-sourcemaps'
import camelCase from 'lodash.camelcase'
import typescript from 'rollup-plugin-typescript2'
import json from 'rollup-plugin-json'

const pkg = require('./package.json')

const libraryName = 'axios'

export default {
  input: `src/index.ts`,
  output: [
    { file: pkg.main, name: camelCase(libraryName), format: 'umd', sourcemap: true },
    { file: pkg.module, format: 'es', sourcemap: true }
  ],
  // Indicate here external modules you don't wanna include in your bundle (i.e.: 'lodash')
  external: [],
  watch: {
    include: 'src/**'
  },
  plugins: [
    // Allow json resolution
    json(),
    // Compile TypeScript files
    typescript({ useTsconfigDeclarationDir: true }),
    // Allow bundling cjs modules (unlike webpack, rollup doesn't understand cjs)
    commonjs(),
    // Allow node_modules resolution, so you can use 'external' to control
    // which external modules to include in the bundle
    // https://github.com/rollup/rollup-plugin-node-resolve#usage
    resolve(),

    // Resolve source maps to the original source
    sourceMaps()
  ]
}
</code></pre></div><h3 id="rollup简单讲解："><a href="#rollup简单讲解：" aria-hidden="true" class="header-anchor">#</a> rollup简单讲解：</h3> <ul><li>input: 打包入口文件</li> <li>output：输出的目标文件，是个对象数组，我们可以指定输出格式，umd（通用模块规范，兼容AMD commonjs），es模式等</li> <li>external: 外部声明 不被打包进入</li> <li>watch: 监听文件变化重新编译，只有在编译的时候开启--watch才生效。</li> <li>plugins: 编译用到的插件 。rollup-plugin-typescript2 就是用来编译 TypeScript 文件，useTsconfigDeclarationDir 表示使用 tsconfig.json 文件中定义的 declarationDir</li></ul> <h4 id="修改package-json"><a href="#修改package-json" aria-hidden="true" class="header-anchor">#</a> 修改package.json</h4> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;main&quot;: &quot;dist/axios.umd.js&quot;,
  &quot;module&quot;: &quot;dist/axios.es5.js&quot;,
  &quot;typings&quot;: &quot;dist/types/index.d.ts&quot;
}
</code></pre></div><p>其中 lib 目录是单个 .ts 文件编译后的 .js 文件。types 目录是所有 .ts 文件编译后生产的 .d.ts 声明文件。axios.es5.js 是编译后生成的 es 模式的入口文件，用在 package.json 的 module 字段，axios.umd.js 文件是编译后生成的 umd 模式的入口文件，用在 package.json 的 main 字段。</p> <h2 id="自动化部署"><a href="#自动化部署" aria-hidden="true" class="header-anchor">#</a> 自动化部署</h2> <p>semantic-release 插件过于黑盒也略微重量,我们自己编写自动化插件</p> <div class="language- extra-class"><pre class="language-text"><code>  &quot;scripts&quot;: {
    ...
  &quot;prepub&quot;: &quot;npm run test:prod &amp;&amp; npm run build&quot;,
  &quot;pub&quot;: &quot;sh release.sh&quot;
  },
  &quot;repository&quot;: {//关联远程参考地址
    &quot;type&quot;: &quot;git&quot;,
    &quot;url&quot;: &quot;git+https://github.com/Suremotoo/ts-axios-doc.git&quot;
  },
</code></pre></div><p><code>prepub</code>钩子在执行<code>npm run pub</code>的时候优先执行，<code>&amp;&amp;</code>便是前面命令执行完再执行后面的。</p> <p>npm run test:prod 实际上运行了 npm run lint &amp;&amp; npm run test -- --no-cache。 先运行 lint 去校验我们的源码和测试文件是否遵循 tslint 规范，再运行 test 去跑测试。</p> <p>npm run build 实际上运行了 tsc --module commonjs、rollup -c rollup.config.ts 和 typedoc --out docs --target es6 --theme minimal --mode file src。先运行 tsc 去编译我们的 TypeScript 文件，dist/lib 和 dist/types 下的文件就是该命令产生的，然后运行 rollup 去构建 axios.umd.js 及 axios.es.js，最后运行 typedoc 去构建项目的文档。</p> <p>运行完 prepub 后就会再运行 pub 命令，实际上执行了 sh release.sh 命令，但是目前我们没有这个脚本，接下来我们就需要来编写部署脚本 release.sh。</p> <h3 id="编写部署脚本"><a href="#编写部署脚本" aria-hidden="true" class="header-anchor">#</a> 编写部署脚本</h3> <p>release.sh</p> <div class="language- extra-class"><pre class="language-text"><code>#!/usr/bin/env sh
set -e
echo &quot;Enter release version: &quot;
read VERSION
read -p &quot;Releasing $VERSION - are you sure? (y/n)&quot; -n 1 -r
echo  # (optional) move to a new line
if [[ $REPLY =~ ^[Yy]$ ]]
then
  echo &quot;Releasing $VERSION ...&quot;

  # commit
  git add -A
  git commit -m &quot;[build] $VERSION&quot;
  npm version $VERSION --message &quot;[release] $VERSION&quot;
  git push origin master

  # publish
  npm publish
fi
</code></pre></div><p><strong>解读</strong>部署脚本是 shell 脚本，shell 脚本就是封装了多行控制台命令</p> <p><code>#!/usr/bin/env sh</code> 用来表示它是一个 shell 脚本。</p> <p><code>set -e</code> 告诉脚本如果执行结果不为 true 则退出。</p> <p><code>echo &quot;Enter release version: &quot;</code> 在控制台输出 Enter release version:。</p> <p><code>read VERSION</code> 表示从标准输入读取值，并赋值给 $VERSION 变量。</p> <p><code>read -p &quot;Releasing $VERSION - are you sure? (y/n)&quot; -n 1 -r</code>，其中 read -p 表示给出提示符，后面接着 Releasing $VERSION - are you sure? (y/n) 提示符；-n 1 表示限定最多可以有 1 个字符可以作为有效读入；-r 表示禁止反斜线的转义功能。因为我们的 read 并没有指定变量名，那么默认这个输入读取值会赋值给 $REPLY 变量。</p> <p><code>echo</code> 输出空值表示跳到一个新行，<code>#</code> 在 shell 脚本中表示注释。</p> <p><code>if [[ $REPLY =~ ^[Yy]$ ]]</code> 表示 shell 脚本中的流程控制语句，判断 $REPLY 是不是大小写的 y，如果满足，则走到后面的 then 逻辑。</p> <p><code>echo &quot;Releasing $VERSION ...&quot;</code> 在控制台输出 Releasing $VERSION ...。</p> <p><code>git add -A</code> 表示把代码所有变化提交到暂存区。</p> <p><code>git commit -m &quot;[build] $VERSION&quot;</code> 表示提交代码，提交注释是 [build] $VERSION。</p> <p><code>npm version $VERSION --message &quot;[release] $VERSION&quot;</code> 是修改 package.json 中的 version 字段到 $VERSION，并且提交一条修改记录，提交注释是 [release] $VERSION。</p> <p><code>git push origin master</code> 是把代码发布到主干分支。</p> <p><code>npm publish</code> 是把仓库发布到 npm 上，我们会把 dist 目录下的代码都发布到 npm 上，因为我们在 package.json 中配置的是 files 是 [&quot;dist&quot;]。
<code>fi</code>if 结束</p> <h3 id="运行部署脚本"><a href="#运行部署脚本" aria-hidden="true" class="header-anchor">#</a> 运行部署脚本</h3> <p>/* istanbul ignore next */ 忽略某些代码分支的测试。</p> <p>当我们执行 npm run pub时候，先执行test，再build,再执行release.sh自动部署。就完成了整个代码的发布流程</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/501981732/my-vuepress/edit/master/FE/从0用ts重构axios.md" target="_blank" rel="noopener noreferrer">改善此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/24/2019, 7:50:41 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/40.e6cc435a.js" defer></script><script src="/assets/js/app.2e26f941.js" defer></script>
  </body>
</html>
