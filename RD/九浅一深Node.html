<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>本篇是《深入浅出nodejs》总结篇 | gblw</title>
    <meta name="description" content="一个前端小学生">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.ac99ad03.css" as="style"><link rel="preload" href="/assets/js/app.2e26f941.js" as="script"><link rel="preload" href="/assets/js/68.52c632f2.js" as="script"><link rel="prefetch" href="/assets/js/1.9abbfca6.js"><link rel="prefetch" href="/assets/js/10.f5aa46b0.js"><link rel="prefetch" href="/assets/js/11.8d9fc089.js"><link rel="prefetch" href="/assets/js/12.da5d20a5.js"><link rel="prefetch" href="/assets/js/13.7ccc43bd.js"><link rel="prefetch" href="/assets/js/14.936637cc.js"><link rel="prefetch" href="/assets/js/15.35e22122.js"><link rel="prefetch" href="/assets/js/16.287d904c.js"><link rel="prefetch" href="/assets/js/17.7040011b.js"><link rel="prefetch" href="/assets/js/18.7659f702.js"><link rel="prefetch" href="/assets/js/19.9e094f67.js"><link rel="prefetch" href="/assets/js/20.1a01400b.js"><link rel="prefetch" href="/assets/js/21.a8d12454.js"><link rel="prefetch" href="/assets/js/22.9ebe5653.js"><link rel="prefetch" href="/assets/js/23.f1967079.js"><link rel="prefetch" href="/assets/js/24.174f624d.js"><link rel="prefetch" href="/assets/js/25.c79ed86e.js"><link rel="prefetch" href="/assets/js/26.404bf4b8.js"><link rel="prefetch" href="/assets/js/27.2f1aff94.js"><link rel="prefetch" href="/assets/js/28.062e58ea.js"><link rel="prefetch" href="/assets/js/29.20a59d1a.js"><link rel="prefetch" href="/assets/js/3.c5473e86.js"><link rel="prefetch" href="/assets/js/30.930bca93.js"><link rel="prefetch" href="/assets/js/31.bd2ca60e.js"><link rel="prefetch" href="/assets/js/32.0a5874ee.js"><link rel="prefetch" href="/assets/js/33.feeb8947.js"><link rel="prefetch" href="/assets/js/34.030535d4.js"><link rel="prefetch" href="/assets/js/35.01224053.js"><link rel="prefetch" href="/assets/js/36.9bc679ea.js"><link rel="prefetch" href="/assets/js/37.e5d7c81b.js"><link rel="prefetch" href="/assets/js/38.f7b94dc4.js"><link rel="prefetch" href="/assets/js/39.2e4c3e17.js"><link rel="prefetch" href="/assets/js/4.0acad576.js"><link rel="prefetch" href="/assets/js/40.e6cc435a.js"><link rel="prefetch" href="/assets/js/41.f50d104c.js"><link rel="prefetch" href="/assets/js/42.ee95280a.js"><link rel="prefetch" href="/assets/js/43.e003dc81.js"><link rel="prefetch" href="/assets/js/44.56217885.js"><link rel="prefetch" href="/assets/js/45.22c09290.js"><link rel="prefetch" href="/assets/js/46.c698132a.js"><link rel="prefetch" href="/assets/js/47.7e5929fe.js"><link rel="prefetch" href="/assets/js/48.0dc5263c.js"><link rel="prefetch" href="/assets/js/49.3c6d7ea6.js"><link rel="prefetch" href="/assets/js/5.759e7092.js"><link rel="prefetch" href="/assets/js/50.7d658f31.js"><link rel="prefetch" href="/assets/js/51.fbd8c3c3.js"><link rel="prefetch" href="/assets/js/52.e3eb2ede.js"><link rel="prefetch" href="/assets/js/53.10c05965.js"><link rel="prefetch" href="/assets/js/54.0ecccd4c.js"><link rel="prefetch" href="/assets/js/55.a85740c6.js"><link rel="prefetch" href="/assets/js/56.77e3a891.js"><link rel="prefetch" href="/assets/js/57.67babd87.js"><link rel="prefetch" href="/assets/js/58.856f7672.js"><link rel="prefetch" href="/assets/js/59.d03ef1b7.js"><link rel="prefetch" href="/assets/js/6.8621d802.js"><link rel="prefetch" href="/assets/js/60.b1170398.js"><link rel="prefetch" href="/assets/js/61.97dd3d3c.js"><link rel="prefetch" href="/assets/js/62.b2eedb7b.js"><link rel="prefetch" href="/assets/js/63.fb58a706.js"><link rel="prefetch" href="/assets/js/64.9aa1b041.js"><link rel="prefetch" href="/assets/js/65.faaf9d55.js"><link rel="prefetch" href="/assets/js/66.fbba48ae.js"><link rel="prefetch" href="/assets/js/67.c8593857.js"><link rel="prefetch" href="/assets/js/69.7a87fda1.js"><link rel="prefetch" href="/assets/js/7.594670aa.js"><link rel="prefetch" href="/assets/js/70.0f9d8114.js"><link rel="prefetch" href="/assets/js/71.d7a82f0c.js"><link rel="prefetch" href="/assets/js/72.fb115c3b.js"><link rel="prefetch" href="/assets/js/73.e56484a9.js"><link rel="prefetch" href="/assets/js/74.ea8bc62e.js"><link rel="prefetch" href="/assets/js/75.5c7a35ab.js"><link rel="prefetch" href="/assets/js/76.3617452b.js"><link rel="prefetch" href="/assets/js/77.8ab6c71a.js"><link rel="prefetch" href="/assets/js/78.b1fe5865.js"><link rel="prefetch" href="/assets/js/79.ea4ba328.js"><link rel="prefetch" href="/assets/js/8.178a8915.js"><link rel="prefetch" href="/assets/js/80.42c16667.js"><link rel="prefetch" href="/assets/js/81.b5141187.js"><link rel="prefetch" href="/assets/js/82.17c01558.js"><link rel="prefetch" href="/assets/js/83.b735e3e5.js"><link rel="prefetch" href="/assets/js/84.15e7b175.js"><link rel="prefetch" href="/assets/js/9.e55349fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ac99ad03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gblw</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link router-link-active">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/FE/" class="nav-link">前端相关</a></div><div class="nav-item"><a href="/RD/" class="nav-link router-link-active">后端相关</a></div><div class="nav-item"><a href="/utils/" class="nav-link">环境相关</a></div><div class="nav-item"><a href="/DB/" class="nav-link">数据库相关</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">npm包</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-koa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa工程生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-easy-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue多功能搬砖器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/vue-image-base64" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片转base64组件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/@gblw/vue-x-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue插件@gblw/vue-x-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/ls-cache-files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ls-cache-files缓存静态文件
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/501981732/my-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/RD/&lt;&lt;Node.js实战&gt;&gt;.html" class="sidebar-link">&lt;&lt;Node.js实战&gt;&gt;总结篇</a></li><li><a href="/RD/九浅一深Node.html" class="active sidebar-link">&lt;&lt;深入浅出nodejs&gt;&gt;总结篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#本篇是《深入浅出nodejs》总结篇" class="sidebar-link">本篇是《深入浅出nodejs》总结篇</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#第四章-异步编程" class="sidebar-link">第四章 异步编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#高阶函数：可以把函数当成参数，或者返回值的函数。" class="sidebar-link">高阶函数：可以把函数当成参数，或者返回值的函数。</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#偏函数：通过预先定义部分参数，来生成一个新的定制函数。" class="sidebar-link">偏函数：通过预先定义部分参数，来生成一个新的定制函数。</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#_3-2异步编程的优势难点" class="sidebar-link">3.2异步编程的优势难点</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#_4-3异步编程解决方案" class="sidebar-link">4.3异步编程解决方案</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#发布订阅模式" class="sidebar-link">发布订阅模式</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#继承events模块" class="sidebar-link">继承events模块</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#雪崩问题" class="sidebar-link">雪崩问题</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#多异步之间的协作方案" class="sidebar-link">多异步之间的协作方案</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#利用偏函数完成多对一的收敛，和发布-订阅模式完成一对多的发散" class="sidebar-link">利用偏函数完成多对一的收敛，和发布/订阅模式完成一对多的发散</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#eventproxy" class="sidebar-link">EventProxy</a></li></ul></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#node内存控制" class="sidebar-link">node内存控制</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#buffer" class="sidebar-link">buffer</a></li><li class="sidebar-sub-header"><a href="/RD/九浅一深Node.html#构建web应用" class="sidebar-link">构建WEB应用</a></li></ul></li><li><a href="/RD/RESTful.html" class="sidebar-link">RESTful API</a></li><li><a href="/RD/IOC.html" class="sidebar-link">I0C</a></li><li><a href="/RD/AOP面向切面编程.html" class="sidebar-link">AOP面向切面编程</a></li><li><a href="/RD/Linux命令初探.html" class="sidebar-link">Linux命令初探</a></li><li><a href="/RD/Node内存控制.html" class="sidebar-link">Node内存控制</a></li><li><a href="/RD/大规模node项目架构.html" class="sidebar-link">大规模node项目架构</a></li><li><a href="/RD/Node上线相关.html" class="sidebar-link">Node上线相关</a></li><li><a href="/RD/同学，你的Docker掉了.html" class="sidebar-link">同学，你的Docker掉了</a></li><li><a href="/RD/exports和module.exports区别.html" class="sidebar-link">exports和module.exports区别</a></li><li><a href="/RD/koa express解析.html" class="sidebar-link">koa中间件原理解析&amp;&amp;express解析</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="本篇是《深入浅出nodejs》总结篇"><a href="#本篇是《深入浅出nodejs》总结篇" aria-hidden="true" class="header-anchor">#</a> 本篇是《深入浅出nodejs》总结篇</h2> <ul><li><p>node适用于IO密集型，不适用于CUP密集型？因为Node是单线程，可以用pm2创建个多线程的~ 或者编写c/c++模块解决，或者利用子进程，将一些NODE进程当成常驻服务进程用于计算，利用进程间的消息来传递结果，将计算和I/O分离，这样还能充分利用多CPUbut归根到底不是做多线程的东西。</p></li> <li><p>Node面向网络，且擅长并行IO,IO密集的优势主要是在于node利用事件循环的处理能力</p></li> <li><p>setTimeout0 和process.nextTick()区别</p> <ul><li>后者更加高效，只会将回调放入队列中，下一轮Tick取出执行，前者采用黑红树的操作，时间复杂度为 O(log(n)),后者0(1)</li></ul></li> <li><p>setImmediate 和process.nextTick类似</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正常'</span><span class="token punctuation">)</span>

<span class="token string">'正常'</span>
<span class="token string">'nextTick'</span>
<span class="token string">'setImmediate'</span>
</code></pre></div><pre><code>-   事件循环对观察者的检查是有先后顺序的：*idle观察者*先与*I/O观察者*先于*check观察者*，process.nextTick属于idle观察者，setImmediate属于check观察者。
-   在实现上：process.nextTick()的回调放在数组，setImmediate回调放在链表
-   在行为上：每轮循环process.nextTick()会将数组的回调全部执行，setImmediate每轮循环只执行链表中的第一个回调：（**现在版本9.0.0已不是如此，setImmediate也会全部执行完**）
</code></pre> <div class="language-js extra-class"><pre class="language-js"><code>process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//加入两个setImmediate</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate延时执行1'</span><span class="token punctuation">)</span>
    <span class="token comment">//进入下次循环</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'强势插入'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate延时执行2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正常'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="第四章-异步编程"><a href="#第四章-异步编程" aria-hidden="true" class="header-anchor">#</a> 第四章 异步编程</h2> <h3 id="高阶函数：可以把函数当成参数，或者返回值的函数。"><a href="#高阶函数：可以把函数当成参数，或者返回值的函数。" aria-hidden="true" class="header-anchor">#</a> 高阶函数：可以把函数当成参数，或者返回值的函数。</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">bar</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><pre><code>结合node最基础的事件模块：事件的处理方式正式基于高阶函数的特性来完成的。可以为相同的事件注册不同的回调。
</code></pre> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="偏函数：通过预先定义部分参数，来生成一个新的定制函数。"><a href="#偏函数：通过预先定义部分参数，来生成一个新的定制函数。" aria-hidden="true" class="header-anchor">#</a> 偏函数：通过预先定义部分参数，来生成一个新的定制函数。</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> toString <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">isString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[Object String]'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[Object Function]'</span>
<span class="token punctuation">}</span>
</code></pre></div><pre><code>利用偏函数像工厂一样生成很多类似函数
</code></pre> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> toString <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">isType</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token string">`[Object </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> isString <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'String'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> isFunction <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token function">isString</span><span class="token punctuation">(</span><span class="token string">'sss'</span><span class="token punctuation">)</span> or
<span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'String'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'sss'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2异步编程的优势难点"><a href="#_3-2异步编程的优势难点" aria-hidden="true" class="header-anchor">#</a> 3.2异步编程的优势难点</h3> <pre><code>- 优势
- 难点:
    - 异常处理： try catch无法捕捉异步的错误，Node在异常处理上的规定：把异常作为回调函数的第一个实参换回，若为空则无异常
    - 嵌套过深
    - 阻塞代码 sleep(1000)函数 利用setTimeout()
    - 多线程编程
</code></pre> <h3 id="_4-3异步编程解决方案"><a href="#_4-3异步编程解决方案" aria-hidden="true" class="header-anchor">#</a> 4.3异步编程解决方案</h3> <ul><li>发布订阅模式</li> <li>Promise/Deferred</li> <li>流程控制库</li> <li>现在还有ES6的gejerator函数和async函数</li></ul> <h3 id="发布订阅模式"><a href="#发布订阅模式" aria-hidden="true" class="header-anchor">#</a> 发布订阅模式</h3> <pre><code>- 继承events模块
- 利用事件队列解决雪崩问题
- 多异步之间的协作方案
- eventProxy原理
</code></pre> <h3 id="继承events模块"><a href="#继承events模块" aria-hidden="true" class="header-anchor">#</a> 继承events模块</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//util模块有继承的方法</span>
<span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    events<span class="token punctuation">.</span>EventEmitter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>Stream<span class="token punctuation">,</span>events<span class="token punctuation">.</span>EventEmitter<span class="token punctuation">)</span>

</code></pre></div><h3 id="雪崩问题"><a href="#雪崩问题" aria-hidden="true" class="header-anchor">#</a> 雪崩问题</h3> <pre><code>雪崩问题:高访问，大并发量的情况下缓存失效的情况，(服务刚好启动，缓存中又不存在数据)，
改进方案: step1.加**状态锁** step2.利用once进入 **事件队列**
</code></pre> <p>服务刚好启动，缓存中又不存在数据，如果访问量大，同一SQL会被发送到数据库中反复查询，影响服务的整体性能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//某一条数据库查询语句</span>
<span class="token keyword">var</span> <span class="token function-variable function">select</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'SQL'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token string">'ready'</span>
<span class="token keyword">var</span> <span class="token function-variable function">select</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">'ready'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">'pending'</span>
        db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'SQL'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state <span class="token operator">=</span> <span class="token string">'ready'</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是这种情况下连续多次调用select是有第一次是生效的，后面是没有数据服务的，这个时候可以引入 <strong>事件队列</strong></p> <pre><code>利用once将所有请求的回调都压入事件队列中，利用其只执行一次就会将监视器移除的特点，保证每一个回调都只会被执行一次，对于相同的SQL语句，保证在同一个查询从开始到结束的过程永远只有一次。对于相同的SQL语句，保证听同一个查询从开始到结束过程永远只有一次，SQL在进行查询时，新到来的相同调用只需要在队列中等待数据就绪即可，一旦查询结束，得到的结果会被这些调用同时使用 **节约重复的数据库调用的开销**
</code></pre> <p>由于Node是单线程，无需担心状态同步问题，这种方式可以应用到其他远程调用的场景中，及时外部没有缓存策略，也能节约重复开销。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token string">'ready'</span>
<span class="token keyword">var</span> <span class="token function-variable function">select</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    proxy<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">'ready'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">'pending'</span>
        db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'SQL'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            proxy<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">)</span>
            state <span class="token operator">=</span> <span class="token string">'ready'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="多异步之间的协作方案"><a href="#多异步之间的协作方案" aria-hidden="true" class="header-anchor">#</a> 多异步之间的协作方案</h3> <p>一般事件和监听器是一对多的关系，假如事件和监听器是多对一的关系，如何享受异步I/0带来的性能提升，又能保证良好的编码风格？（多个事件调用其实是并行关系，但是为了解决问题只能串行解决？ no）</p> <p>假如多个调用并无先后关系，相互之间又无交集，我们需要一个 第三方函数和变量来处理异步协作的结果 --<strong>哨兵变量</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//当模板，数据，本地资源全部就绪之后再渲染页面</span>
 <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> <span class="token function-variable function">done</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//渲染页面</span>
        <span class="token function">render</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>template_path<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">,</span>temp<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
I18n<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">,</span>resource<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>我们可以利用 <strong>偏函数</strong>来处理哨兵变量和第三方函数的关系。</p> <h3 id="利用偏函数完成多对一的收敛，和发布-订阅模式完成一对多的发散"><a href="#利用偏函数完成多对一的收敛，和发布-订阅模式完成一对多的发散" aria-hidden="true" class="header-anchor">#</a> 利用偏函数完成多对一的收敛，和发布/订阅模式完成一对多的发散</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//利用偏函数完成多对一的收敛</span>
<span class="token keyword">function</span> <span class="token function">after</span><span class="token punctuation">(</span>timer<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        count<span class="token operator">++</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>render<span class="token punctuation">)</span>
<span class="token comment">//随着业务的扩展，我们可以利用发布/订阅模式，完成多对多的场景</span>

<span class="token keyword">let</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span>done<span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span>other<span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>template_path<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span><span class="token string">&quot;template&quot;</span><span class="token punctuation">,</span>template<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
I18n<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">,</span>resource<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="eventproxy"><a href="#eventproxy" aria-hidden="true" class="header-anchor">#</a> EventProxy</h3> <p>上面还有一点优化的地方，就是，我们需要准备done函数，还需要手动一次次把数据传过去，EventProxy模块，作为发布/订阅模式的扩展，可以解决此问题。(前后端都可用)</p> <pre><code>**原理** 它在非all事件触发时都会触发一次all事件。EventProxy是将all作为事件流的拦截
</code></pre> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token string">'resource'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span>data<span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// todo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>template_path<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    proxy<span class="token punctuation">.</span><span class="token function">emitter</span><span class="token punctuation">(</span><span class="token string">&quot;template&quot;</span><span class="token punctuation">,</span>template<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>query<span class="token operator">...</span>
<span class="token operator">...</span>
</code></pre></div><h2 id="node内存控制"><a href="#node内存控制" aria-hidden="true" class="header-anchor">#</a> node内存控制</h2> <p><a href="/img/node内存控制.pdf">node内存控制</a></p> <embed src="/img/node内存控制.pdf" width="500" height="375" type="application/pdf"> <h2 id="buffer"><a href="#buffer" aria-hidden="true" class="header-anchor">#</a> buffer</h2> <p><a href="/img/Buffer.pdf">Buffer</a></p> <embed src="/img/Buffer.pdf" width="500" height="375" type="application/pdf"> <h2 id="构建web应用"><a href="#构建web应用" aria-hidden="true" class="header-anchor">#</a> 构建WEB应用</h2> <p><a href="/img/构建WEB应用.pdf">构建WEB应用</a></p> <embed src="/img/构建WEB应用.pdf" width="500" height="375" type="application/pdf"></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/501981732/my-vuepress/edit/master/RD/九浅一深Node.md" target="_blank" rel="noopener noreferrer">改善此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/24/2019, 4:46:49 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/68.52c632f2.js" defer></script><script src="/assets/js/app.2e26f941.js" defer></script>
  </body>
</html>
